{
  "openapi": "3.0.1",
  "info": {
    "title": "EPZ Агрегатор аналитики",
    "description": "API мониторинга",
    "version": "1"
  },
  "paths": {
    "/epz/analytics-aggregator/api/configuration": {
      "get": {
        "tags": [
          "Конфигурация"
        ],
        "summary": "Текущие настройки конфигурации",
        "description": "Возвращает текущие настройки с описанием и встроенными значениями по умолчанию",
        "operationId": "configuration",
        "responses": {
          "200": {
            "description": "Корректный результат",
            "content": {
              "application/json": {
                "schema": {
                  "minItems": 0,
                  "uniqueItems": true,
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ConfigurationJsonParameter"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/epz/analytics-aggregator/api/test": {
      "get": {
        "tags": [
          "Тестирование"
        ],
        "summary": "Тестовый метод для тестирования",
        "description": "При выполнении должен вернуть `ОК` в формате `JSON`",
        "operationId": "getOkMessage",
        "responses": {
          "200": {
            "description": "Корректный результат с значением `OK`",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponseMessageJson"
                }
              }
            }
          }
        }
      }
    },
    "/epz/analytics-aggregator/api/lastElasticResults": {
      "get": {
        "tags": [
          "Тестирование"
        ],
        "summary": "Последние запросы и ответы от Elasticsearch",
        "description": "Возвращает массив из объектов `LastElasticRequestOrResponseJson`",
        "operationId": "getLastElasticRequestsAndResponses",
        "responses": {
          "200": {
            "description": "Корректный результат",
            "content": {
              "application/json": {
                "schema": {
                  "maxItems": 4,
                  "minItems": 4,
                  "uniqueItems": true,
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/LastElasticRequestOrResponseJson"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/epz/analytics-aggregator/api/openapi": {
      "get": {
        "tags": [
          "Конфигурация"
        ],
        "summary": "Current API specification",
        "description": "This one return generated jaxrs-api.json for Swagger-UI",
        "operationId": "getJsonFormResource",
        "responses": {
          "200": {
            "description": "Specification in JSON",
            "content": {
              "application/json": {}
            }
          }
        }
      }
    },
    "/epz/analytics-aggregator/api/schedule": {
      "get": {
        "tags": [
          "Мониторинг"
        ],
        "summary": "Список заданий",
        "description": "Возвращает список заданий в `JSON`",
        "operationId": "getSchedulesStats",
        "responses": {
          "200": {
            "description": "Результат в виде `JSON`",
            "content": {
              "application/json": {}
            }
          }
        }
      },
      "put": {
        "tags": [
          "Мониторинг"
        ],
        "summary": "Запуск заданий вручную",
        "description": "Передается строковый параметр с наименованием задания",
        "operationId": "startSchedule",
        "requestBody": {
          "description": "Параметр `StartScheduleParameterJson`",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StartScheduleParameterJson"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Удачное выполнение",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponseMessageJson"
                }
              }
            }
          },
          "406": {
            "description": "Ошибка, некорректный параметр",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponseMessageJson"
                }
              }
            }
          },
          "500": {
            "description": "Ошибка выполнения",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponseMessageJson"
                }
              }
            }
          }
        }
      }
    },
    "/epz/analytics-aggregator/api/schedule/enabled": {
      "get": {
        "tags": [
          "Мониторинг"
        ],
        "summary": "Настройка включения расписания задания",
        "description": "Состояние настройки включающей расписания для заданий",
        "operationId": "getScheduleEnabled",
        "responses": {
          "200": {
            "description": "Возвращает `ResponseMessageJson` с булевым значением (`true` - включено , `false` - выключено)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResponseMessageJson"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ConfigurationJsonParameter": {
        "required": [
          "currentValue",
          "defaultValue",
          "description",
          "parameterName",
          "state"
        ],
        "type": "object",
        "properties": {
          "currentValue": {
            "type": "string",
            "description": "Текущее значение в приложении"
          },
          "defaultValue": {
            "type": "string",
            "description": "Значение по умолчанию(из сборки)"
          },
          "description": {
            "type": "string",
            "description": "Описание параметра"
          },
          "lastConsulQueryTime": {
            "type": "string",
            "description": "Время последнего запроса параметра из Consul",
            "format": "date-time"
          },
          "parameterName": {
            "type": "string",
            "description": "Параметр(путь Consul KV)"
          },
          "state": {
            "type": "string",
            "description": "Состояние, `loaded` - загружен из Consul, `timed out` - значение должно быть обновлено из Consul, `not found` - не найден в Consul"
          }
        },
        "description": "Параметр конфигурации"
      },
      "ResponseMessageJson": {
        "required": [
          "response"
        ],
        "type": "object",
        "properties": {
          "response": {
            "type": "string",
            "description": "Тело ответа"
          }
        },
        "description": "Ответ сервиса"
      },
      "LastElasticRequestOrResponseJson": {
        "required": [
          "operationType"
        ],
        "type": "object",
        "properties": {
          "operationResult": {
            "type": "string",
            "description": "Тело запроса или ответа",
            "format": "string"
          },
          "operationType": {
            "type": "string",
            "description": "Тип операции",
            "format": "string"
          }
        },
        "description": "Объект отражающий запрос или ответ для определенной операции"
      },
      "StartScheduleParameterJson": {
        "required": [
          "jobName"
        ],
        "type": "object",
        "properties": {
          "jobName": {
            "type": "string",
            "description": "Наименование задания"
          }
        },
        "description": "Параметр для запуска заданий"
      }
    }
  }
}
